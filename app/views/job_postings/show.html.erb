<main id="content" role="main">
  <div class="gradient-overlay-half-primary-v2">
    <div class="container space-top-lg-3 space-top-md-4 space-1 mt-3">
      <%= render partial: "/job_posting_searches/form" %>
    </div>
  </div>
  
  <div class="container">
    <div class="space-2">
      <div class="row">
        <div class="col-lg-8 mb-9 mb-lg-0">
          <div class="media mb-2">
            <% if @job_posting.company_logo_url.present? %>
              <div class="mr-4 company-logo-wrapper">
                <%= image_tag @job_posting.company_logo_url, class: "img-fluid company-logo", style: "vertical-align: middle;" %>
              </div>
            <% end %>

            <div class="media-body">
              <div class="row">
                <div class="col-12 mb-3 mb-lg-0">
                  <h1 class="h4 mb-1"><%= @job_posting.title %></h1>
                  <small class="h6 font-weight-light text-muted">
                    <%= link_to @job_posting.company_name, @job_posting.company_url, target: "_blank", class: "text-link" %>
                    <span class="px-1">â€¢</span>
                    <%= @job_posting.company_location %>
                  </small>
                  <ul class="list-inline my-3">
                    <% @job_posting.keywords.each do |keyword| %>
                    <li class="list-inline-item pb-1">
                      <%= link_to keyword,
                        job_posting_searches_path(job_posting_search: { full_text_search: "#{@job_posting_search.full_text_search} #{keyword}"}),
                        class: "btn btn-sm btn-soft-primary mb-1 job-listing-keyword", method: :post %>
                      <% end %>
                    </li>
                  </ul>
                </div>
              </div>
            </div>
          </div>

          <hr>

          <h4 class="h4 mb-1">Job Description</h4>
          <div class="mb-4">
            <p class="text-muted font-size-1">
              Posted <%= time_ago_in_words(@job_posting.start_date) %> ago
              <% if @job_posting.source == ENUMS::JOB_SOURCES::GITHUB %>
                on <a href="https://jobs.github.com/" target="_blank">GitHub Jobs</a>
              <% end %>
              <% if @job_posting.source == ENUMS::JOB_SOURCES::REMOTEOK %>
                on <a href="https://remoteok.io/" target="_blank">RemoteOK</a>
              <% end %>
            </p>
          </div>

          <div class="mb-7 job-listing__description">
            <%= @job_posting.pretty_description %>
          </div>

          <% if @job_posting.how_to_apply %>
            <div class="mb-7 pt-3 job-listing__how-to-apply" id="how-to-apply">
              <h4 class="h4">How to apply</h4>
              <%= sanitize @job_posting.how_to_apply, scrubber: Loofah::Scrubbers::Prune.new %>
            </div>
          <% end %>
        </div>

        <div class="col-lg-4">
          <div class="pl-lg-4">
            <!-- Sidebar Info -->
            <div class="card border-0 shadow-sm mb-3">
              <!-- Header -->
              <header id="SVGwave1BottomShapeID1" class="svg-preloader card-header border-bottom-0 bg-primary text-white p-0">
                <div class="pt-5 px-5">
                  <h3 class="h5">Job Summary</h3>
                </div>

                <figure class="ie-wave-1-bottom mt-n5">
                  <img class="js-svg-injector" src="../../assets/svg/components/wave-1-bottom.svg" alt="Image Description"
                        data-parent="#SVGwave1BottomShapeID1">
                </figure>
              </header>
              <!-- End Header -->

              <!-- Content -->
              <div class="card-body pt-1 px-5 pb-5">
                <% if @job_posting.company_host_url %>
                  <div class="media mb-3">
                    <div class="min-width-4 text-center text-primary mt-1 mr-3">
                      <span class="fas fa-globe"></span>
                    </div>
                    <div class="media-body">
                      <%= link_to @job_posting.company_host_url, @job_posting.company_url, class: "font-weight-medium", target: "_blank" %>
                      <small class="d-block text-secondary">Website</small>
                    </div>
                  </div>
                <% end %>

                <div class="media mb-3">
                  <div class="min-width-4 text-center text-primary mt-1 mr-3">
                    <span class="fas fa-map-marked-alt"></span>
                  </div>
                  <div class="media-body">
                    <span class="d-block font-weight-medium"><%= @job_posting.city %></span>
                    <small class="d-block text-secondary">Location</small>
                  </div>
                </div>

                <div class="media mb-3">
                  <div class="min-width-4 text-center text-primary mt-1 mr-3">
                    <span class="fas fa-clock"></span>
                  </div>
                  <div class="media-body">
                    <span class="d-block font-weight-medium"><%= @job_posting.job_type.humanize.titleize %></span>
                    <small class="d-block text-secondary">Job type</small>
                  </div>
                </div>

                <% if @job_posting.min_annual_salary_cents > 0 %>
                  <div class="media mb-3">
                    <div class="min-width-4 text-center text-primary mt-1 mr-3">
                      <span class="fas fa-money-bill-alt"></span>
                    </div>
                    <div class="media-body">
                      <span class="d-block font-weight-medium">Salary</span>
                      <small class="d-block text-secondary"><%= @job_posting.salary_range %></small>
                    </div>
                  </div>
                <% end %>

                <% if @job_posting.how_to_apply %>
                  <a class="js-go-to btn btn-sm btn-block mt-5 btn-soft-primary transition-3d-hover" href="javascript:;"
                    data-target="#how-to-apply"
                    data-compensation="#navBar"
                    data-type="static">Apply Now</a>
                <% end %>
              </div>
              <!-- End Content -->
            </div>
            <!-- End Sidebar Info -->

            <div id="codefund"></div>
            <script src="https://codefund.app/properties/173/funder.js?keywords=<%= @job_posting.keywords.join(',') %>" async="async"></script>
          </div>
        </div>
      </div>

      <!-- Sticky Block End Point -->
      <div id="stickyBlockEndPoint"></div>
    </div>
  </div>


  <div id="SVGwave5Top" class="svg-preloader position-relative gradient-half-primary-v1">
    <div class="container space-top-3 space-top-md-4 space-bottom-2">
      <!-- Title -->
      <div class="w-md-80 w-lg-50 text-center mx-md-auto mb-9">
        <h2 class="font-weight-medium text-light">Similar Jobs</h2>
        <p class="text-light">Here are some more jobs that match your search criteria</p>
      </div>
      <!-- End Title -->

      <div class="card-deck d-block d-lg-flex card-lg-gutters-2">
        <%= render partial: "/job_postings/card", collection: @similar_job_postings[0..3], as: :job_posting %>
      </div>

      <div class="card-deck d-block d-lg-flex card-lg-gutters-2">
        <%= render partial: "/job_postings/card", collection: @similar_job_postings[4..7], as: :job_posting %>
      </div>

      <div class="card-deck d-block d-lg-flex card-lg-gutters-2">
        <%= render partial: "/job_postings/card", collection: @similar_job_postings[8..11], as: :job_posting %>
      </div>

      <div class="text-center mt-3">
        <%= link_to "View all Open Jobs", job_posting_search_path(0), class: "btn btn-white text-primary transition-3d-hover", method: :delete %>
      </div>

      <!-- SVG Top Shape -->
      <figure class="position-absolute top-0 right-0 left-0 z-index-2">
        <img class="js-svg-injector" src="../../assets/svg/components/wave-5-top.svg" alt="Image Description"
            data-parent="#SVGwave5Top">
      </figure>
      <!-- End SVG Top Shape -->
    </div>

  </div>
</main>